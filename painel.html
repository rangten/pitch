<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anúncio Fácil IA</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-color: #ffffff;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      header {
        background-color: white;
        color: #000000;
        font-weight: bold;
        font-size: 18px;
        padding: 10px 20px;
        border-bottom: 1px solid #ccc;
      }

      .container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        overflow-y: auto;
      }

      .box {
        max-width: 600px;
        width: 100%;
      }

      .info {
        background-color: #f1f1f1;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .upload-area {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        margin-bottom: 15px;
      }

      .upload-area input[type="file"] {
        display: none;
      }

      .upload-label {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        font-size: 28px;
        border: 2px dashed #7f56d9;
        border-radius: 8px;
        color: #7f56d9;
        cursor: pointer;
      }

      .preview {
        position: relative;
        width: 80px;
        height: 80px;
      }

      .preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      .remove-btn {
        position: absolute;
        top: -6px;
        right: -6px;
        background: #ff3b30;
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
      }

      .chat-box {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 15px;
      }

      .chat-msg {
        padding: 10px;
        background-color: #f4f4f4;
        border-radius: 6px;
        white-space: pre-line;
      }

      .user-msg {
        align-self: flex-end;
        background-color: #e0e0ff;
      }

      .input-area {
        display: flex;
        align-items: center;
        border: 1px solid #ccc;
        border-radius: 6px;
        padding: 6px 10px;
      }

      .input-area input {
        flex: 1;
        border: none;
        outline: none;
        font-size: 14px;
      }

      .input-area button {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #7f56d9;
      }
    </style>
  </head>
  <body>
    <header>Anúncio Fácil IA</header>
    <div class="container">
      <div class="box">
        <div class="info">
          <p><strong>O que este assistente faz:</strong></p>
          <ul>
            <li>✓ Gera 5 títulos com palavras-chave</li>
            <li>✓ Cria descrição profissional e persuasiva</li>
            <li>✓ Gera 5 imagens com base na imagem enviada (modelo vestindo a peça)</li>
          </ul>
        </div>

        <div class="upload-area" id="uploadArea">
          <label class="upload-label" for="fileInput">+</label>
          <input type="file" id="fileInput" accept="image/png" multiple />
        </div>

        <div class="chat-box" id="chat"></div>

        <form id="form" class="input-area">
          <input type="text" id="prompt" placeholder="Descreva sua peça de roupa aqui..." required />
          <button type="submit">➤</button>
        </form>
      </div>
    </div>

    <script>
      const fileInput = document.getElementById('fileInput');
      const uploadArea = document.getElementById('uploadArea');
      const chat = document.getElementById('chat');
      const form = document.getElementById('form');
      const promptInput = document.getElementById('prompt');
      const files = [];

      fileInput.addEventListener('change', () => {
        [...fileInput.files].forEach((file) => {
          if (files.length >= 3) return alert('Limite de 3 imagens');

          const reader = new FileReader();
          reader.onload = (e) => {
            const div = document.createElement('div');
            div.className = 'preview';
            div.innerHTML = `
              <img src="${e.target.result}" alt="preview">
              <button class="remove-btn">x</button>
            `;
            div.querySelector('button').onclick = () => {
              uploadArea.removeChild(div);
              const index = files.indexOf(file);
              if (index > -1) files.splice(index, 1);
            };
            uploadArea.appendChild(div);
          };
          reader.readAsDataURL(file);
          files.push(file);
        });
        fileInput.value = '';
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const prompt = promptInput.value.trim();
        if (!prompt) return;

        const userMsg = document.createElement('div');
        userMsg.className = 'chat-msg user-msg';
        userMsg.textContent = prompt;
        chat.appendChild(userMsg);

        const botMsg = document.createElement('div');
        botMsg.className = 'chat-msg';
        botMsg.textContent = 'Gerando anúncio com base na imagem...';
        chat.appendChild(botMsg);

        try {
          const openaiKey = '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'; // substituído no backend por sua chave

          const formData = new FormData();
          formData.append('prompt', prompt);
          files.forEach((f, i) => formData.append(`image${i + 1}`, f));

          const response = await fetch('https://api.anunciofacil.app/processar', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${openaiKey}` },
            body: formData
          });

          const data = await response.json();

          botMsg.textContent = data.output;
          data.images?.forEach(url => {
            const img = document.createElement('img');
            img.src = url;
            img.style.maxWidth = '100%';
            chat.appendChild(img);
          });

        } catch (err) {
          botMsg.textContent = 'Erro ao gerar o anúncio. Tente novamente.';
        }

        form.reset();
      });
    </script>
  </body>
</html>
